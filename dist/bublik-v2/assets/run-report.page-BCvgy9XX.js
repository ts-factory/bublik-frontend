import{j as t}from"./shiki-BV2GtVUq.js";import{m as _,n as w,T as S,I as R,j as N,aC as k,D as $,e as L,C as A,aD as I,o as P,aE as T,aF as D,aG as E,aH as V,aI as z,s as j,aJ as C,aK as G,y as O,ah as B}from"./index-Dl0N3GU2.js";import{i as H,j as M}from"./react-BSMx3yqy.js";import"./reactJsonView-KCeSiE7A.js";import"./echarts-lseLLy92.js";import"./monaco-CpmLxh5C.js";import"./prettier-BE4rBlSX.js";const F={visible:{opacity:1,y:"0%"},hidden:{opacity:0,y:"100%"},exit:{opacity:0,y:"100%"}},K={bounce:.1};function Q(i){const{items:e=[],onResetClick:n,onRemoveClick:o,onOpenClick:r}=i,s=e.length;return t.jsx(_,{children:s?t.jsxs(w.div,{variants:F,initial:"hidden",animate:"visible",exit:"exit",transition:K,className:"fixed bottom-4 z-50 right-4 bg-white rounded-lg shadow-popover min-w-[360px] max-h-[90vh] flex flex-col",layout:"size",children:[t.jsxs("div",{className:"flex flex-col gap-2 px-4 pt-2 flex-1 overflow-auto",children:[t.jsx("h1",{className:"text-[0.875rem] leading-[1.125rem] font-semibold mb-2",children:"Selected Charts"}),t.jsx("ul",{className:"flex flex-col gap-2 mb-4",children:e.map(d=>t.jsxs("li",{className:"flex items-center gap-2 justify-between p-2 border rounded border-border-primary hover:bg-gray-50",children:[t.jsx("div",{children:t.jsx("span",{className:"text-[0.6875rem] font-medium leading-[0.875rem]",children:d.label})}),t.jsx(S,{content:"Remove from stacked",disableHoverableContent:!0,children:t.jsx("button",{"aria-label":"Remove from stacked",className:"grid transition-colors rounded place-items-center text-text-unexpected hover:bg-red-100",onClick:()=>o?.(d.id),children:t.jsx(R,{name:"CrossSimple",className:"size-5 translate-y-[2px]"})})})]},d.id))})]}),t.jsx("div",{className:"flex flex-col gap-2 px-4 py-2 mt-2 border-t border-border-primary",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(N,{variant:"primary",rounded:"lg",size:"md",className:"w-full justify-center",onClick:r,disabled:e.length<=1,children:[t.jsx(R,{name:"LineChartMultiple",className:"size-6 mr-2"}),t.jsx("span",{children:"Stacked"})]}),t.jsx(N,{variant:"outline",rounded:"lg",size:"md",className:"w-full justify-center",onClick:n,children:t.jsx("span",{children:"Reset"})})]})})]}):null})}function W(){const{selectedRecords:i,clearIds:e,removeId:n,toggleStacked:o}=k(),r=i.map(s=>({id:s.id,label:s.measurement.label??""}));return t.jsx(Q,{items:r,onResetClick:e,onRemoveClick:n,onOpenClick:()=>o(!0)})}function J(i){const e=i.map(s=>s.argsVals).filter(s=>!!s);if(e.length<=1)return new Set;const n=new Set,o=e[0];return new Set(e.flatMap(s=>Object.keys(s))).forEach(s=>{const d=o[s];e.some(b=>b[s]!==d)&&n.add(s)}),n}function U(i,e){if(!i||e.size===0)return"";const n=[];return e.forEach(o=>{o in i&&n.push(`${o}: ${i[o]}`)}),n.length>0?n.join(" | "):""}function X(i){const e={fontFamily:"Inter",fontSize:10,fontWeight:500,lineHeight:18},n=i.map(a=>a.chart),o=J(i),r=new Map,s=[];n.forEach(a=>{const c=a.axis_y.label;if(!r.has(c)){const f=s.length;r.set(c,f),s.push({type:"value",name:c,nameGap:20,nameLocation:"end",position:f===0?"left":"right",offset:f<=1?0:(f-1)*120,axisLine:{show:!0},axisTick:{show:!0},scale:!0})}});let d=0;const g=[],b=[],v=new Map;return i.forEach(a=>{const c=v.get(a.measurementLabel)||0;v.set(a.measurementLabel,c+1)}),n.forEach((a,c)=>{const f=r.get(a.axis_y.label)??0,u=i[c],l=U(u.argsVals,o);a.data.forEach(m=>{const h=`dataset_${d++}`;g.push({id:h,source:m.points.map(x=>({[a.axis_x.key]:Number(x.x_value),[a.axis_y.key]:Number(x.y_value),iteration_id:x.metadata?.iteration_id??0,result_id:x.metadata?.result_id??0}))});let p;const y=v.get(u.measurementLabel);if(a.data.length>1&&a.series_label){const x=`${a.series_label}: ${m.series} - ${a.axis_y.label}`;p=l?`${x} (${l})`:x}else if(a.data.length>1){const x=`${m.series} - ${a.axis_y.label}`;p=l?`${x} (${l})`:x}else l&&y&&y<=1?p=`${a.axis_y.label} (${l})`:y&&y>1?l?p=`${u.measurementLabel} (${l})`:p=`${c} - ${u.measurementLabel}`:u.measurementLabel&&u.measurementLabel!==a.axis_y.label?p=u.measurementLabel:p=a.axis_y.label;b.push({type:"line",name:p,datasetId:h,yAxisIndex:f,encode:{x:a.axis_x.key,y:a.axis_y.key},smooth:!1,showSymbol:!0,symbolSize:6})})}),{dataset:g,xAxis:{type:"value",name:n[0]?.axis_x.label||"X Axis",nameLocation:"middle",nameGap:20,nameTextStyle:e,axisLabel:e},yAxis:s.map(a=>({...a,axisLabel:e,nameTextStyle:{...e,align:"left"}})),series:b,dataZoom:[{type:"inside",xAxisIndex:[0]},{type:"inside",yAxisIndex:n.map((a,c)=>c)},{type:"slider",xAxisIndex:[0],bottom:10}],grid:{top:"12%",left:"5%",right:s.length>1?`${8*(s.length-1)+5}%`:"5%",bottom:"9%"},tooltip:{trigger:"axis",extraCssText:"shadow-popover rounded-lg",textStyle:e,axisPointer:{type:"line"},formatter:a=>{if(!Array.isArray(a)||a.length===0)return"";const c=a[0],f=c.value?.x_value??c.value?.[0]??c.axisValue;let u=`<strong>${n[0].axis_x.label}: ${f}</strong><br/>`;return a.forEach(l=>{let m;l.value&&typeof l.value=="object"?m=l.value.y_value??l.value[1]??l.data?.y_value:Array.isArray(l.value)?m=l.value[1]:m=l.value;const h=typeof m=="number"?m.toLocaleString(void 0,{maximumFractionDigits:2}):m;u+=`${l.marker} ${l.seriesName}: <strong>${h}</strong><br/>`}),u}},legend:{top:"1%",left:"left",type:"scroll",animationDurationUpdate:200,pageButtonPosition:"start"}}}function Z(){const{selectedRecords:i,isStackedOpen:e,toggleStacked:n}=k(),o=i.reduce((r,s)=>(s?.chart&&r.push({chart:s.chart,argsVals:s.argsVals.args_vals,measurementLabel:s.measurement.label}),r),[]);return o.length?t.jsx($,{open:e,onOpenChange:n,children:t.jsxs(L,{className:P("bg-white shadow-popover flex flex-col overflow-hidden w-[80vw] max-w-[80vw]"),children:[t.jsx(A,{label:"Stacked Chart"}),t.jsx("div",{className:"p-1 flex-1",children:t.jsx(I,{options:X(o),style:{height:"100%",width:"100%"}})})]})}):null}function q({runId:i,configId:e}){const{data:n,isLoading:o,error:r}=z(e&&i?{configId:e,runId:i}:j),{data:s,isLoading:d,error:g}=C(i??j);return{isLoading:o||d,details:s,blocks:n,error:r??g}}function Y(i){const{runId:e,configId:n}=i,{details:o,blocks:r,error:s,isLoading:d}=q({runId:e,configId:n});return d?t.jsx(T,{}):s?t.jsx(D,{error:s}):!r||!o?t.jsx(E,{}):t.jsx(V,{runId:Number(e),blocks:r,details:o})}function ce(){const[i]=H(),{runId:e}=M(),n=i.get("config");return ee({runId:e?Number(e):void 0}),n?e?t.jsx("div",{className:"flex flex-col gap-1 p-2",children:t.jsxs(G,{runId:Number(e),configId:Number(n),children:[t.jsx(Y,{runId:Number(e),configId:Number(n)}),t.jsx(W,{}),t.jsx(Z,{})]})}):t.jsx("div",{className:"flex flex-col gap-1 p-2",children:"No run id found!"}):t.jsx("div",{className:"flex flex-col gap-1 p-2",children:"No config id found!"})}function ee({runId:i}){const{data:e}=C(i??j);let n="Report - Bublik";if(i&&e){const{main_package:o,start:r}=e,s=O(r);n=`${o} | ${s} | ${i} | Report - Bublik`}B(n)}export{ce as RunReportPage};
//# sourceMappingURL=run-report.page-BCvgy9XX.js.map
